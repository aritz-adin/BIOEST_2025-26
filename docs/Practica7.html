<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Aritz Adin">
<meta name="dcterms.date" content="2025-01-12">

<title>Práctica 7: Análisis de Supervivencia – BIOEST 2025-26</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-dfb324f25d9b1687192fa8be62ac8f9c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">BIOEST 2025-26</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Programa</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Practica0.html"> 
<span class="menu-text">Práctica 0</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Practica1.html"> 
<span class="menu-text">Práctica 1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Practica2.html"> 
<span class="menu-text">Práctica 2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Practica3.html"> 
<span class="menu-text">Práctica 3</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Practica4.html"> 
<span class="menu-text">Práctica 4</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Practica5.html"> 
<span class="menu-text">Práctica 5</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Practica6.html"> 
<span class="menu-text">Práctica 6</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./Practica7.html" aria-current="page"> 
<span class="menu-text">Práctica 7</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./PracticaRepaso.html"> 
<span class="menu-text">Práctica Repaso</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#ejercicio-1" id="toc-ejercicio-1" class="nav-link active" data-scroll-target="#ejercicio-1">Ejercicio 1</a>
  <ul class="collapse">
  <li><a href="#introduce-los-datos-manualmente-en-r-o-lee-el-fichero-dispositivo.txt." id="toc-introduce-los-datos-manualmente-en-r-o-lee-el-fichero-dispositivo.txt." class="nav-link" data-scroll-target="#introduce-los-datos-manualmente-en-r-o-lee-el-fichero-dispositivo.txt.">1.1. Introduce los datos manualmente en R o lee el fichero <code>dispositivo.txt</code>.</a></li>
  <li><a href="#estima-la-función-de-supervivencia-st-por-kaplan-meier.-calcula-los-errores-estándar-y-proporciona-un-i.c.-al-95-para-st." id="toc-estima-la-función-de-supervivencia-st-por-kaplan-meier.-calcula-los-errores-estándar-y-proporciona-un-i.c.-al-95-para-st." class="nav-link" data-scroll-target="#estima-la-función-de-supervivencia-st-por-kaplan-meier.-calcula-los-errores-estándar-y-proporciona-un-i.c.-al-95-para-st.">1.2. Estima la función de supervivencia <span class="math inline">\(S(t)\)</span> por Kaplan-Meier. Calcula los errores estándar y proporciona un I.C. al 95% para <span class="math inline">\(S(t)\)</span>.</a></li>
  <li><a href="#dibuja-la-función-de-supervivencia-estimada-con-su-correspondiente-intervalo-de-confianza." id="toc-dibuja-la-función-de-supervivencia-estimada-con-su-correspondiente-intervalo-de-confianza." class="nav-link" data-scroll-target="#dibuja-la-función-de-supervivencia-estimada-con-su-correspondiente-intervalo-de-confianza.">1.3. Dibuja la función de supervivencia estimada con su correspondiente intervalo de confianza.</a></li>
  <li><a href="#cuál-es-la-probabilidad-de-que-el-tiempo-de-uso-del-dispositivo-supere-las-19-semanas-proporciona-los-correspondientes-intervalos-de-confianza-al-95-e-interpreta-su-significado." id="toc-cuál-es-la-probabilidad-de-que-el-tiempo-de-uso-del-dispositivo-supere-las-19-semanas-proporciona-los-correspondientes-intervalos-de-confianza-al-95-e-interpreta-su-significado." class="nav-link" data-scroll-target="#cuál-es-la-probabilidad-de-que-el-tiempo-de-uso-del-dispositivo-supere-las-19-semanas-proporciona-los-correspondientes-intervalos-de-confianza-al-95-e-interpreta-su-significado.">1.4. ¿Cuál es la probabilidad de que el tiempo de uso del dispositivo supere las 19 semanas? Proporciona los correspondientes intervalos de confianza al 95% e interpreta su significado.</a></li>
  <li><a href="#a-partir-de-qué-semana-la-supervivencia-es-menor-al-80" id="toc-a-partir-de-qué-semana-la-supervivencia-es-menor-al-80" class="nav-link" data-scroll-target="#a-partir-de-qué-semana-la-supervivencia-es-menor-al-80">1.5. ¿A partir de qué semana la supervivencia es menor al 80%?</a></li>
  </ul></li>
  <li><a href="#ejercicio-2" id="toc-ejercicio-2" class="nav-link" data-scroll-target="#ejercicio-2">Ejercicio 2</a>
  <ul class="collapse">
  <li><a href="#estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-para-los-distintos-grupos-del-tratamiento.-crees-que-existen-diferencias-entre-las-curvas" id="toc-estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-para-los-distintos-grupos-del-tratamiento.-crees-que-existen-diferencias-entre-las-curvas" class="nav-link" data-scroll-target="#estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-para-los-distintos-grupos-del-tratamiento.-crees-que-existen-diferencias-entre-las-curvas">1.1. Estima curvas de supervivencia por el método de Kaplan y Meier para los distintos grupos del tratamiento. ¿Crees que existen diferencias entre las curvas?</a></li>
  <li><a href="#comprueba-si-las-diferencias-observadas-en-las-curvas-son-o-no-estadísticamente-significativas-utilizando-el-test-de-log-rank-y-el-test-de-peto-peto." id="toc-comprueba-si-las-diferencias-observadas-en-las-curvas-son-o-no-estadísticamente-significativas-utilizando-el-test-de-log-rank-y-el-test-de-peto-peto." class="nav-link" data-scroll-target="#comprueba-si-las-diferencias-observadas-en-las-curvas-son-o-no-estadísticamente-significativas-utilizando-el-test-de-log-rank-y-el-test-de-peto-peto.">1.2. Comprueba si las diferencias observadas en las curvas son o no estadísticamente significativas utilizando el test de Log-Rank y el test de Peto-Peto.</a></li>
  <li><a href="#cuál-es-la-probabilidad-que-un-individuo-del-grupo-lev5fu-viva-más-de-127-días-proporciona-un-intervalo-de-confianza-al-95-para-dicha-probabilidad." id="toc-cuál-es-la-probabilidad-que-un-individuo-del-grupo-lev5fu-viva-más-de-127-días-proporciona-un-intervalo-de-confianza-al-95-para-dicha-probabilidad." class="nav-link" data-scroll-target="#cuál-es-la-probabilidad-que-un-individuo-del-grupo-lev5fu-viva-más-de-127-días-proporciona-un-intervalo-de-confianza-al-95-para-dicha-probabilidad.">1.3. ¿Cuál es la probabilidad que un individuo del grupo “Lev+5FU” viva más de 127 días? Proporciona un intervalo de confianza al 95% para dicha probabilidad.</a></li>
  <li><a href="#estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-según-el-sexo.-crees-que-existen-diferencias-entre-las-curvas" id="toc-estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-según-el-sexo.-crees-que-existen-diferencias-entre-las-curvas" class="nav-link" data-scroll-target="#estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-según-el-sexo.-crees-que-existen-diferencias-entre-las-curvas">1.4. Estima curvas de supervivencia por el método de Kaplan y Meier según el sexo. ¿Crees que existen diferencias entre las curvas?</a></li>
  <li><a href="#estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-según-si-el-tumor-se-diferencia-bien-moderadamente-o-mal.-crees-que-existen-diferencias-entre-las-curvas" id="toc-estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-según-si-el-tumor-se-diferencia-bien-moderadamente-o-mal.-crees-que-existen-diferencias-entre-las-curvas" class="nav-link" data-scroll-target="#estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-según-si-el-tumor-se-diferencia-bien-moderadamente-o-mal.-crees-que-existen-diferencias-entre-las-curvas">1.5. Estima curvas de supervivencia por el método de Kaplan y Meier según si el tumor se diferencia bien, moderadamente o mal. ¿Crees que existen diferencias entre las curvas?</a></li>
  <li><a href="#estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-según-la-extensión-del-tumor.-crees-que-existen-diferencias-entre-las-curvas" id="toc-estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-según-la-extensión-del-tumor.-crees-que-existen-diferencias-entre-las-curvas" class="nav-link" data-scroll-target="#estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-según-la-extensión-del-tumor.-crees-que-existen-diferencias-entre-las-curvas">1.6. Estima curvas de supervivencia por el método de Kaplan y Meier según la extensión del tumor. ¿Crees que existen diferencias entre las curvas?</a></li>
  <li><a href="#estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-a-partir-de-los-siguientes-valores-de-la-variable-edad-grupo-1-1845-grupo-2-4565-y-grupo-3-65.-crees-que-existen-diferencias-entre-las-curvas" id="toc-estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-a-partir-de-los-siguientes-valores-de-la-variable-edad-grupo-1-1845-grupo-2-4565-y-grupo-3-65.-crees-que-existen-diferencias-entre-las-curvas" class="nav-link" data-scroll-target="#estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-a-partir-de-los-siguientes-valores-de-la-variable-edad-grupo-1-1845-grupo-2-4565-y-grupo-3-65.-crees-que-existen-diferencias-entre-las-curvas">1.7. Estima curvas de supervivencia por el método de Kaplan y Meier a partir de los siguientes valores de la variable edad: grupo 1 [18,45], grupo 2 (45,65] y grupo 3 (65,+]. ¿Crees que existen diferencias entre las curvas?</a></li>
  </ul></li>
  <li><a href="#para-entregar" id="toc-para-entregar" class="nav-link" data-scroll-target="#para-entregar">Para entregar</a>
  <ul class="collapse">
  <li><a href="#estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-para-los-grupos-standard-y-test-del-tratamiento.-son-las-curvas-significativamente-distintas" id="toc-estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-para-los-grupos-standard-y-test-del-tratamiento.-son-las-curvas-significativamente-distintas" class="nav-link" data-scroll-target="#estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-para-los-grupos-standard-y-test-del-tratamiento.-son-las-curvas-significativamente-distintas">1.1. Estima curvas de supervivencia por el método de Kaplan y Meier para los grupos standard y test del tratamiento. ¿Son las curvas significativamente distintas?</a></li>
  <li><a href="#cuál-es-la-supervivencia-en-el-instante-13-para-los-distintos-grupos-qué-significa" id="toc-cuál-es-la-supervivencia-en-el-instante-13-para-los-distintos-grupos-qué-significa" class="nav-link" data-scroll-target="#cuál-es-la-supervivencia-en-el-instante-13-para-los-distintos-grupos-qué-significa">1.2. ¿Cuál es la supervivencia en el instante 13 para los distintos grupos? ¿Qué significa?</a></li>
  <li><a href="#estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-a-partir-de-los-siguientes-valores-de-la-variable-karnofsky-grupo-1-0-50-años-grupo-2-50-70-y-grupo-3-70-100." id="toc-estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-a-partir-de-los-siguientes-valores-de-la-variable-karnofsky-grupo-1-0-50-años-grupo-2-50-70-y-grupo-3-70-100." class="nav-link" data-scroll-target="#estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-a-partir-de-los-siguientes-valores-de-la-variable-karnofsky-grupo-1-0-50-años-grupo-2-50-70-y-grupo-3-70-100.">1.3. Estima curvas de supervivencia por el método de Kaplan y Meier a partir de los siguientes valores de la variable Karnofsky: grupo 1 (0-50] años, grupo 2 (50-70] y grupo 3 (70-100].</a></li>
  <li><a href="#comprueba-si-las-diferencias-observadas-en-las-curvas-son-o-no-estadísticamente-significativas-utilizando-el-test-de-log-rank-y-el-test-de-peto-peto.-alpha0.05" id="toc-comprueba-si-las-diferencias-observadas-en-las-curvas-son-o-no-estadísticamente-significativas-utilizando-el-test-de-log-rank-y-el-test-de-peto-peto.-alpha0.05" class="nav-link" data-scroll-target="#comprueba-si-las-diferencias-observadas-en-las-curvas-son-o-no-estadísticamente-significativas-utilizando-el-test-de-log-rank-y-el-test-de-peto-peto.-alpha0.05">1.4. Comprueba si las diferencias observadas en las curvas son o no estadísticamente significativas utilizando el test de Log-Rank y el test de Peto-Peto. <span class="math inline">\(\alpha=0.05\)</span></a></li>
  <li><a href="#cuál-es-la-probabilidad-de-supervivencia-para-el-grupo-1-0-50-en-el-día-24-y-en-el-grupo-2-5070.-proporciona-un-intervalo-de-confianza-al-95-para-dichas-probabilidades." id="toc-cuál-es-la-probabilidad-de-supervivencia-para-el-grupo-1-0-50-en-el-día-24-y-en-el-grupo-2-5070.-proporciona-un-intervalo-de-confianza-al-95-para-dichas-probabilidades." class="nav-link" data-scroll-target="#cuál-es-la-probabilidad-de-supervivencia-para-el-grupo-1-0-50-en-el-día-24-y-en-el-grupo-2-5070.-proporciona-un-intervalo-de-confianza-al-95-para-dichas-probabilidades.">1.5 ¿Cuál es la probabilidad de supervivencia para el grupo 1 (0-50] en el día 24? ¿Y en el grupo 2 (50,70]?. Proporciona un intervalo de confianza al 95% para dichas probabilidades.</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Práctica 7: Análisis de Supervivencia</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Aritz Adin </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">01/12/2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="ejercicio-1" class="level2">
<h2 class="anchored" data-anchor-id="ejercicio-1">Ejercicio 1</h2>
<p>En pruebas con anticonceptivos, un criterio evidente de aceptación de dicho anticonceptivo es la prevención de embarazos. Sin embargo, los anticonceptivos modernos muestran tasas de fallo muy bajas, y por tanto las alteraciones en ocurrencia de hemorragias, como amenorrea (una ausencia prolongada de hemorragia), hemorragias irregulares o prolongadas, son importantes a la hora de evaluar un método anticonceptivo.</p>
<p>Para promocionar la investigación en este tema la OMS (WHO) ha proporcionado datos de ensayos clínicos realizadas con distintos tipos de anticonceptivos. Una parte de este conjunto de datos tiene que ver con el tiempo que transcurre desde que una mujer comienza a usar un método particular hasta que suspende su uso.</p>
<p>Los datos que presentamos a continuación corresponden al número de semanas que transcurren desde el comienzo de uso de un dispositivo intrauterino particular (DIU) llamado Multiload 250, hasta que se suspende su uso por problemas de hemorragias. Los datos corresponden a 18 mujeres entre 18 y 35 años que habían experimentado dos embarazos previos.</p>
<p>En este ejemplo el tiempo de origen en que se comienza el estudio es a partir del primer día de uso del DIU y el tiempo final es la suspensión debido a problemas hemorrágicos.</p>
<p>Algunas mujeres suspendieron el uso del DIU porque deseaban quedarse embarazadas mientras que otras simplemente se perdió su seguimiento. Por ello aparecen algunos datos censurados.</p>
<p>Un objetivo de este análisis es <strong>resumir la distribución de los tiempos de suspensión del uso del dispositivo intrauterino</strong>.</p>
<p><strong>Datos</strong>: Tiempo en semanas hasta la suspensión de uso del DIU</p>
<p>10, 13+, 18+, 19, 23+, 30, 36, 38+, 54+ 56+, 59, 75, 93, 97, 104+, 107, 107+, 107+</p>
<p>Responde a las siguientes preguntas:</p>
<section id="introduce-los-datos-manualmente-en-r-o-lee-el-fichero-dispositivo.txt." class="level3">
<h3 class="anchored" data-anchor-id="introduce-los-datos-manualmente-en-r-o-lee-el-fichero-dispositivo.txt.">1.1. Introduce los datos manualmente en R o lee el fichero <code>dispositivo.txt</code>.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>diu <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"dispositivo.txt"</span>, <span class="at">header=</span>T)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(diu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   time status
1    10      1
2    13      0
3    18      0
4    19      1
5    23      0
6    30      1
7    36      1
8    38      0
9    54      0
10   56      0
11   59      1
12   75      1
13   93      1
14   97      1
15  104      0
16  107      1
17  107      0
18  107      0</code></pre>
</div>
</div>
</section>
<section id="estima-la-función-de-supervivencia-st-por-kaplan-meier.-calcula-los-errores-estándar-y-proporciona-un-i.c.-al-95-para-st." class="level3">
<h3 class="anchored" data-anchor-id="estima-la-función-de-supervivencia-st-por-kaplan-meier.-calcula-los-errores-estándar-y-proporciona-un-i.c.-al-95-para-st.">1.2. Estima la función de supervivencia <span class="math inline">\(S(t)\)</span> por Kaplan-Meier. Calcula los errores estándar y proporciona un I.C. al 95% para <span class="math inline">\(S(t)\)</span>.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Intervalo de confianza con la transformación logística (por defecto) ##</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>diu.surv1 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span><span class="dv">1</span>, diu)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(diu.surv1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(time, status) ~ 1, data = diu)

 time n.risk n.event survival std.err lower 95% CI upper 95% CI
   10     18       1    0.944  0.0540       0.8443        1.000
   19     15       1    0.881  0.0790       0.7395        1.000
   30     13       1    0.814  0.0978       0.6429        1.000
   36     12       1    0.746  0.1107       0.5577        0.998
   59      8       1    0.653  0.1303       0.4413        0.965
   75      7       1    0.559  0.1412       0.3411        0.917
   93      6       1    0.466  0.1452       0.2532        0.858
   97      5       1    0.373  0.1430       0.1759        0.791
  107      3       1    0.249  0.1392       0.0829        0.745</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Intervalo de confianza asumiendo normalidad ##</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>diu.surv2 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span><span class="dv">1</span>, diu, <span class="at">conf.type=</span><span class="st">"plain"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(diu.surv2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(time, status) ~ 1, data = diu, conf.type = "plain")

 time n.risk n.event survival std.err lower 95% CI upper 95% CI
   10     18       1    0.944  0.0540       0.8386        1.000
   19     15       1    0.881  0.0790       0.7267        1.000
   30     13       1    0.814  0.0978       0.6220        1.000
   36     12       1    0.746  0.1107       0.5290        0.963
   59      8       1    0.653  0.1303       0.3972        0.908
   75      7       1    0.559  0.1412       0.2827        0.836
   93      6       1    0.466  0.1452       0.1816        0.751
   97      5       1    0.373  0.1430       0.0927        0.653
  107      3       1    0.249  0.1392       0.0000        0.522</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Intervalo de confianza con la transformación clog-log ##</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>diu.surv3 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span><span class="dv">1</span>, diu, <span class="at">conf.type=</span><span class="st">"log-log"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(diu.surv3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(time, status) ~ 1, data = diu, conf.type = "log-log")

 time n.risk n.event survival std.err lower 95% CI upper 95% CI
   10     18       1    0.944  0.0540       0.6664        0.992
   19     15       1    0.881  0.0790       0.6019        0.969
   30     13       1    0.814  0.0978       0.5241        0.936
   36     12       1    0.746  0.1107       0.4536        0.897
   59      8       1    0.653  0.1303       0.3438        0.843
   75      7       1    0.559  0.1412       0.2564        0.780
   93      6       1    0.466  0.1452       0.1830        0.710
   97      5       1    0.373  0.1430       0.1209        0.631
  107      3       1    0.249  0.1392       0.0468        0.531</code></pre>
</div>
</div>
</section>
<section id="dibuja-la-función-de-supervivencia-estimada-con-su-correspondiente-intervalo-de-confianza." class="level3">
<h3 class="anchored" data-anchor-id="dibuja-la-función-de-supervivencia-estimada-con-su-correspondiente-intervalo-de-confianza.">1.3. Dibuja la función de supervivencia estimada con su correspondiente intervalo de confianza.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(diu.surv1, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">main=</span><span class="st">"Función supervivencia por Kaplan-Meier"</span>, <span class="at">xlab=</span><span class="st">"Tiempo (semanas)"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(diu.surv2, <span class="at">col=</span><span class="st">"blue"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(diu.surv3, <span class="at">col=</span><span class="st">"black"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>, <span class="fu">c</span>(<span class="st">"logistica"</span>,<span class="st">"normal"</span>,<span class="st">"log-log"</span>), <span class="at">col=</span><span class="fu">c</span>(<span class="st">"red"</span>,<span class="st">"blue"</span>,<span class="st">"black"</span>), <span class="at">lty=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica7_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="cuál-es-la-probabilidad-de-que-el-tiempo-de-uso-del-dispositivo-supere-las-19-semanas-proporciona-los-correspondientes-intervalos-de-confianza-al-95-e-interpreta-su-significado." class="level3">
<h3 class="anchored" data-anchor-id="cuál-es-la-probabilidad-de-que-el-tiempo-de-uso-del-dispositivo-supere-las-19-semanas-proporciona-los-correspondientes-intervalos-de-confianza-al-95-e-interpreta-su-significado.">1.4. ¿Cuál es la probabilidad de que el tiempo de uso del dispositivo supere las 19 semanas? Proporciona los correspondientes intervalos de confianza al 95% e interpreta su significado.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(diu.surv1, <span class="at">times=</span><span class="dv">19</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(time, status) ~ 1, data = diu)

 time n.risk n.event survival std.err lower 95% CI upper 95% CI
   19     15       2    0.881   0.079        0.739            1</code></pre>
</div>
</div>
<p><strong>INTERPRETACIÓN</strong>: La probabilidad estimada de que una mujer no tenga hemorragias y continúe con el uso del DIU al menos hasta la semana 19 (o dicho de otra manera, de que el tiempo de uso del dispositivo supere las 19 semanas) es de 0.881, con un intervalo de confianza al 95% de [0.739, 1.000].</p>
</section>
<section id="a-partir-de-qué-semana-la-supervivencia-es-menor-al-80" class="level3">
<h3 class="anchored" data-anchor-id="a-partir-de-qué-semana-la-supervivencia-es-menor-al-80">1.5. ¿A partir de qué semana la supervivencia es menor al 80%?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(diu.surv1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(time, status) ~ 1, data = diu)

 time n.risk n.event survival std.err lower 95% CI upper 95% CI
   10     18       1    0.944  0.0540       0.8443        1.000
   19     15       1    0.881  0.0790       0.7395        1.000
   30     13       1    0.814  0.0978       0.6429        1.000
   36     12       1    0.746  0.1107       0.5577        0.998
   59      8       1    0.653  0.1303       0.4413        0.965
   75      7       1    0.559  0.1412       0.3411        0.917
   93      6       1    0.466  0.1452       0.2532        0.858
   97      5       1    0.373  0.1430       0.1759        0.791
  107      3       1    0.249  0.1392       0.0829        0.745</code></pre>
</div>
</div>
<p>A partir de la semana 36 la supervivencia es menor al 80%. Sin embargo, mirando el intervalo de confianza vemos que no contiene el valor 0.8 a partir de la semana 97.</p>
</section>
</section>
<section id="ejercicio-2" class="level2">
<h2 class="anchored" data-anchor-id="ejercicio-2">Ejercicio 2</h2>
<p>El fichero <code>colon.txt</code> contiene los resultados de un experimento en 929 pacientes con cáncer de colon en estado B/C que se les suministra quimioterapia adyuvante. Algunas de las variables que recoge el fichero son</p>
<ul>
<li><code>time</code>: tiempo de supervivencia en días</li>
<li><code>status</code>: variable que mide el fallo (1) o la censura (0)</li>
<li><code>rx</code>: tratamiento. “Obs”, “Lev” (Levamisole), “Lev+5FU” (Levamisole +5-FU)</li>
<li><code>sex</code>: male (1) o female (0)</li>
<li><code>age</code>: edad en años</li>
<li><code>differ</code>: diferenciación del tumor (1=bien, 2=moderadamente, 3=mal)</li>
<li><code>extent</code>: extensión local (1=submucosa, 2=músculo, 3=serosa, 4=estructuras contiguas)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>colon <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"colon.txt"</span>, <span class="at">header=</span>T, <span class="at">stringsAsFactors=</span>T)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(colon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   929 obs. of  8 variables:
 $ id    : int  1 2 3 4 5 6 7 8 9 10 ...
 $ time  : int  1521 3087 963 293 659 1767 420 3192 3173 3308 ...
 $ status: int  1 0 1 1 1 1 1 0 0 0 ...
 $ rx    : Factor w/ 3 levels "Lev","Lev+5FU",..: 2 2 3 2 3 2 1 3 1 2 ...
 $ sex   : int  1 1 0 0 1 0 1 1 1 0 ...
 $ age   : int  43 63 71 66 69 57 77 54 46 68 ...
 $ differ: int  2 2 2 2 2 2 2 2 2 2 ...
 $ extent: int  3 3 2 3 3 3 3 3 3 3 ...</code></pre>
</div>
</div>
<section id="estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-para-los-distintos-grupos-del-tratamiento.-crees-que-existen-diferencias-entre-las-curvas" class="level3">
<h3 class="anchored" data-anchor-id="estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-para-los-distintos-grupos-del-tratamiento.-crees-que-existen-diferencias-entre-las-curvas">1.1. Estima curvas de supervivencia por el método de Kaplan y Meier para los distintos grupos del tratamiento. ¿Crees que existen diferencias entre las curvas?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>surv1 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> rx, <span class="at">data=</span>colon)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(surv1, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"red"</span>,<span class="st">"green"</span>,<span class="st">"blue"</span>))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>, <span class="fu">levels</span>(colon<span class="sc">$</span>rx), <span class="at">col=</span><span class="fu">c</span>(<span class="st">"red"</span>,<span class="st">"green"</span>,<span class="st">"blue"</span>), <span class="at">lty=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica7_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>La curva de supervivencia correspondiente al tratamiento “Lev+5FU” está consistentemente por encima de las otras dos curvas (“Lev” y “Lev+5FU”), por lo que el pronóstico de supervivencia es mejor en este grupo que en el resto. Sin embargo, parece no observarse diferencias entre las curvas de supervivencia de los grupos “Lev” y “Obs”.</p>
</section>
<section id="comprueba-si-las-diferencias-observadas-en-las-curvas-son-o-no-estadísticamente-significativas-utilizando-el-test-de-log-rank-y-el-test-de-peto-peto." class="level3">
<h3 class="anchored" data-anchor-id="comprueba-si-las-diferencias-observadas-en-las-curvas-son-o-no-estadísticamente-significativas-utilizando-el-test-de-log-rank-y-el-test-de-peto-peto.">1.2. Comprueba si las diferencias observadas en las curvas son o no estadísticamente significativas utilizando el test de Log-Rank y el test de Peto-Peto.</h3>
<p><strong>Test Log-Rank</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span>rx, colon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survdiff(formula = Surv(time, status) ~ rx, data = colon)

             N Observed Expected (O-E)^2/E (O-E)^2/V
rx=Lev     310      161      146      1.52      2.25
rx=Lev+5FU 304      123      157      7.55     11.62
rx=Obs     315      168      148      2.58      3.85

 Chisq= 11.7  on 2 degrees of freedom, p= 0.003 </code></pre>
</div>
</div>
<p><strong>Test Peto-Peto</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span>rx, <span class="at">rho=</span><span class="dv">1</span>, colon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survdiff(formula = Surv(time, status) ~ rx, data = colon, rho = 1)

             N Observed Expected (O-E)^2/E (O-E)^2/V
rx=Lev     310    122.8      111      1.26      2.38
rx=Lev+5FU 304     93.1      118      5.24     10.27
rx=Obs     315    126.0      113      1.50      2.86

 Chisq= 10.3  on 2 degrees of freedom, p= 0.006 </code></pre>
</div>
</div>
<p>En ambos casos, rechazamos la hipótesis nula de que las curvas de superviviencia KM son iguales para los tres grupos.</p>
</section>
<section id="cuál-es-la-probabilidad-que-un-individuo-del-grupo-lev5fu-viva-más-de-127-días-proporciona-un-intervalo-de-confianza-al-95-para-dicha-probabilidad." class="level3">
<h3 class="anchored" data-anchor-id="cuál-es-la-probabilidad-que-un-individuo-del-grupo-lev5fu-viva-más-de-127-días-proporciona-un-intervalo-de-confianza-al-95-para-dicha-probabilidad.">1.3. ¿Cuál es la probabilidad que un individuo del grupo “Lev+5FU” viva más de 127 días? Proporciona un intervalo de confianza al 95% para dicha probabilidad.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(surv1, <span class="at">times=</span><span class="dv">127</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(time, status) ~ rx, data = colon)

                rx=Lev 
        time       n.risk      n.event     survival      std.err lower 95% CI 
    1.27e+02     3.06e+02     4.00e+00     9.87e-01     6.41e-03     9.75e-01 
upper 95% CI 
    1.00e+00 

                rx=Lev+5FU 
        time       n.risk      n.event     survival      std.err lower 95% CI 
    1.27e+02     2.99e+02     6.00e+00     9.80e-01     7.98e-03     9.65e-01 
upper 95% CI 
    9.96e-01 

                rx=Obs 
        time       n.risk      n.event     survival      std.err lower 95% CI 
    1.27e+02     3.13e+02     2.00e+00     9.94e-01     4.48e-03     9.85e-01 
upper 95% CI 
    1.00e+00 </code></pre>
</div>
</div>
<p><strong>INTERPRETACIÓN</strong>: La probabilidad de que un individuo del grupo “Lev+5FU” viva más de 127 días es de 0.980 con un intervalo de confianza al 95% de [0.965, 0.996].</p>
</section>
<section id="estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-según-el-sexo.-crees-que-existen-diferencias-entre-las-curvas" class="level3">
<h3 class="anchored" data-anchor-id="estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-según-el-sexo.-crees-que-existen-diferencias-entre-las-curvas">1.4. Estima curvas de supervivencia por el método de Kaplan y Meier según el sexo. ¿Crees que existen diferencias entre las curvas?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>surv2 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> sex, <span class="at">data=</span>colon)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(surv2, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"red"</span>,<span class="st">"green"</span>))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>, <span class="fu">c</span>(<span class="st">"Mujer"</span>,<span class="st">"Hombre"</span>), <span class="at">col=</span><span class="fu">c</span>(<span class="st">"red"</span>,<span class="st">"green"</span>), <span class="at">lty=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica7_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span>sex, colon) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survdiff(formula = Surv(time, status) ~ sex, data = colon)

        N Observed Expected (O-E)^2/E (O-E)^2/V
sex=0 445      215      217   0.01049    0.0202
sex=1 484      237      235   0.00965    0.0202

 Chisq= 0  on 1 degrees of freedom, p= 0.9 </code></pre>
</div>
</div>
</section>
<section id="estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-según-si-el-tumor-se-diferencia-bien-moderadamente-o-mal.-crees-que-existen-diferencias-entre-las-curvas" class="level3">
<h3 class="anchored" data-anchor-id="estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-según-si-el-tumor-se-diferencia-bien-moderadamente-o-mal.-crees-que-existen-diferencias-entre-las-curvas">1.5. Estima curvas de supervivencia por el método de Kaplan y Meier según si el tumor se diferencia bien, moderadamente o mal. ¿Crees que existen diferencias entre las curvas?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>surv3 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> differ, <span class="at">data=</span>colon)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(surv3, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"red"</span>,<span class="st">"green"</span>,<span class="st">"blue"</span>))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>, <span class="fu">c</span>(<span class="st">"Bien"</span>,<span class="st">"Moderadamente"</span>,<span class="st">"Mal"</span>), <span class="at">col=</span><span class="fu">c</span>(<span class="st">"red"</span>,<span class="st">"green"</span>,<span class="st">"blue"</span>), <span class="at">lty=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica7_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span>differ, colon) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survdiff(formula = Surv(time, status) ~ differ, data = colon)

n=906, 23 observations deleted due to missingness.

           N Observed Expected (O-E)^2/E (O-E)^2/V
differ=1  93       42     47.5     0.643     0.721
differ=2 663      311    334.9     1.708     7.108
differ=3 150       88     58.6    14.808    17.105

 Chisq= 17.2  on 2 degrees of freedom, p= 2e-04 </code></pre>
</div>
</div>
</section>
<section id="estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-según-la-extensión-del-tumor.-crees-que-existen-diferencias-entre-las-curvas" class="level3">
<h3 class="anchored" data-anchor-id="estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-según-la-extensión-del-tumor.-crees-que-existen-diferencias-entre-las-curvas">1.6. Estima curvas de supervivencia por el método de Kaplan y Meier según la extensión del tumor. ¿Crees que existen diferencias entre las curvas?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>surv4 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> extent, <span class="at">data=</span>colon)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(surv4, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"red"</span>,<span class="st">"green"</span>,<span class="st">"blue"</span>,<span class="st">"orange"</span>))</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>, <span class="fu">c</span>(<span class="st">"submucosa"</span>,<span class="st">"músculo"</span>,<span class="st">"serosa"</span>,<span class="st">"estruc. contiguas"</span>),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">"red"</span>,<span class="st">"green"</span>,<span class="st">"blue"</span>,<span class="st">"orange"</span>), <span class="at">lty=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica7_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span>extent, colon) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survdiff(formula = Surv(time, status) ~ extent, data = colon)

           N Observed Expected (O-E)^2/E (O-E)^2/V
extent=1  21        4     12.8      6.06      6.25
extent=2 106       36     60.9     10.21     11.82
extent=3 759      383    361.7      1.26      6.29
extent=4  43       29     16.6      9.34      9.71

 Chisq= 26.9  on 3 degrees of freedom, p= 6e-06 </code></pre>
</div>
</div>
</section>
<section id="estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-a-partir-de-los-siguientes-valores-de-la-variable-edad-grupo-1-1845-grupo-2-4565-y-grupo-3-65.-crees-que-existen-diferencias-entre-las-curvas" class="level3">
<h3 class="anchored" data-anchor-id="estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-a-partir-de-los-siguientes-valores-de-la-variable-edad-grupo-1-1845-grupo-2-4565-y-grupo-3-65.-crees-que-existen-diferencias-entre-las-curvas">1.7. Estima curvas de supervivencia por el método de Kaplan y Meier a partir de los siguientes valores de la variable edad: grupo 1 [18,45], grupo 2 (45,65] y grupo 3 (65,+]. ¿Crees que existen diferencias entre las curvas?</h3>
<p>En primer lugar definimos la nueva variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>colon<span class="sc">$</span>grupo <span class="ot">&lt;-</span> <span class="fu">cut</span>(colon<span class="sc">$</span>age, <span class="at">include.lowest=</span><span class="cn">TRUE</span>, <span class="at">right=</span><span class="cn">TRUE</span>,</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">18</span>,<span class="dv">45</span>,<span class="dv">65</span>,<span class="fu">max</span>(colon<span class="sc">$</span>age)),</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"grupo 1"</span>,<span class="st">"grupo 2"</span>,<span class="st">"grupo 3"</span>))</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(colon<span class="sc">$</span>grupo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>grupo 1 grupo 2 grupo 3 
    124     471     334 </code></pre>
</div>
</div>
<p>A continuación, estimamos las curvas de supervivencia por el método KM y comprobamos si existen diferencias significativas entre los grupos de edad:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>surv5 <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> grupo, <span class="at">data=</span>colon)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(surv5, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"red"</span>,<span class="st">"green"</span>,<span class="st">"blue"</span>))</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>, <span class="fu">levels</span>(colon<span class="sc">$</span>grupo), <span class="at">col=</span><span class="fu">c</span>(<span class="st">"red"</span>,<span class="st">"green"</span>,<span class="st">"blue"</span>), <span class="at">lty=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practica7_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span>grupo, colon) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survdiff(formula = Surv(time, status) ~ grupo, data = colon)

                N Observed Expected (O-E)^2/E (O-E)^2/V
grupo=grupo 1 124       65     57.9     0.874      1.00
grupo=grupo 2 471      209    237.4     3.386      7.14
grupo=grupo 3 334      178    156.8     2.878      4.41

 Chisq= 7.2  on 2 degrees of freedom, p= 0.03 </code></pre>
</div>
</div>
</section>
</section>
<section id="para-entregar" class="level2">
<h2 class="anchored" data-anchor-id="para-entregar">Para entregar</h2>
<p>Disponemos de 137 pacientes con cancer de pulmón. Los datos se encuentran en el fichero <code>VA</code> de la librería <code>MASS</code>. La variable respuesta es el tiempo de supervivencia en días. El fichero tiene las siguientes variables:</p>
<ul>
<li><code>stime</code>: tiempo de supervivencia en días</li>
<li><code>status</code>: variable que mide el fallo (1) o la censura (0)</li>
<li><code>treat</code>: tratamiento standard (1) o test (2)</li>
<li><code>cell</code>: cuatro tipos distintos de células (1=squamous, 2=smallcell, 3=adeno, 4=large)</li>
<li><code>Karn</code>: puntuación Karnofsky medido en una escala de 0-100, con valores altos para pacientes que se encuentran relativamente bien</li>
<li><code>diag.time</code>: Tiempo en meses desde el diagnóstico al entrar en la prueba</li>
<li><code>age</code>: edad en años</li>
<li><code>prior</code>: variable lógica que determina si hubo terapia a priori (0=no, 10=yes)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"VA"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(VA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   137 obs. of  8 variables:
 $ stime    : num  72 411 228 126 118 10 82 110 314 100 ...
 $ status   : num  1 1 1 1 1 1 1 1 1 0 ...
 $ treat    : Factor w/ 2 levels "1","2": 1 1 1 1 1 1 1 1 1 1 ...
 $ age      : num  69 64 38 63 65 49 69 68 43 70 ...
 $ Karn     : num  60 70 60 60 70 20 40 80 50 70 ...
 $ diag.time: num  7 5 3 9 11 5 10 29 18 6 ...
 $ cell     : Factor w/ 4 levels "1","2","3","4": 1 1 1 1 1 1 1 1 1 1 ...
 $ prior    : Factor w/ 2 levels "0","10": 1 2 1 2 2 1 2 1 1 1 ...</code></pre>
</div>
</div>
<p>Responde a las siguientes preguntas:</p>
<section id="estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-para-los-grupos-standard-y-test-del-tratamiento.-son-las-curvas-significativamente-distintas" class="level3">
<h3 class="anchored" data-anchor-id="estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-para-los-grupos-standard-y-test-del-tratamiento.-son-las-curvas-significativamente-distintas">1.1. Estima curvas de supervivencia por el método de Kaplan y Meier para los grupos standard y test del tratamiento. ¿Son las curvas significativamente distintas?</h3>
</section>
<section id="cuál-es-la-supervivencia-en-el-instante-13-para-los-distintos-grupos-qué-significa" class="level3">
<h3 class="anchored" data-anchor-id="cuál-es-la-supervivencia-en-el-instante-13-para-los-distintos-grupos-qué-significa">1.2. ¿Cuál es la supervivencia en el instante 13 para los distintos grupos? ¿Qué significa?</h3>
</section>
<section id="estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-a-partir-de-los-siguientes-valores-de-la-variable-karnofsky-grupo-1-0-50-años-grupo-2-50-70-y-grupo-3-70-100." class="level3">
<h3 class="anchored" data-anchor-id="estima-curvas-de-supervivencia-por-el-método-de-kaplan-y-meier-a-partir-de-los-siguientes-valores-de-la-variable-karnofsky-grupo-1-0-50-años-grupo-2-50-70-y-grupo-3-70-100.">1.3. Estima curvas de supervivencia por el método de Kaplan y Meier a partir de los siguientes valores de la variable Karnofsky: grupo 1 (0-50] años, grupo 2 (50-70] y grupo 3 (70-100].</h3>
</section>
<section id="comprueba-si-las-diferencias-observadas-en-las-curvas-son-o-no-estadísticamente-significativas-utilizando-el-test-de-log-rank-y-el-test-de-peto-peto.-alpha0.05" class="level3">
<h3 class="anchored" data-anchor-id="comprueba-si-las-diferencias-observadas-en-las-curvas-son-o-no-estadísticamente-significativas-utilizando-el-test-de-log-rank-y-el-test-de-peto-peto.-alpha0.05">1.4. Comprueba si las diferencias observadas en las curvas son o no estadísticamente significativas utilizando el test de Log-Rank y el test de Peto-Peto. <span class="math inline">\(\alpha=0.05\)</span></h3>
</section>
<section id="cuál-es-la-probabilidad-de-supervivencia-para-el-grupo-1-0-50-en-el-día-24-y-en-el-grupo-2-5070.-proporciona-un-intervalo-de-confianza-al-95-para-dichas-probabilidades." class="level3">
<h3 class="anchored" data-anchor-id="cuál-es-la-probabilidad-de-supervivencia-para-el-grupo-1-0-50-en-el-día-24-y-en-el-grupo-2-5070.-proporciona-un-intervalo-de-confianza-al-95-para-dichas-probabilidades.">1.5 ¿Cuál es la probabilidad de supervivencia para el grupo 1 (0-50] en el día 24? ¿Y en el grupo 2 (50,70]?. Proporciona un intervalo de confianza al 95% para dichas probabilidades.</h3>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>